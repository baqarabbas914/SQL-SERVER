Library Management System

Step 1: Create Database

CREATE DATABASE LibraryDB;
USE LibraryDB;

Step 2: Create Tables (3 Core Tables)

-- 1. Members table (library users)
CREATE TABLE Members (
    MemberID INT PRIMARY KEY IDENTITY(1,1),
    FirstName VARCHAR(50) NOT NULL,
    LastName VARCHAR(50) NOT NULL,
    Email VARCHAR(100) UNIQUE,
    MembershipDate DATE DEFAULT GETDATE(),
    IsActive BIT DEFAULT 1  -- 1 for active, 0 for inactive
);

-- 2. Books table
CREATE TABLE Books (
    BookID INT PRIMARY KEY IDENTITY(1,1),
    Title VARCHAR(200) NOT NULL,
    Author VARCHAR(100) NOT NULL,
    ISBN VARCHAR(20) UNIQUE NOT NULL,
    PublishedYear INT,
    AvailableCopies INT DEFAULT 1
);

-- 3. Borrowings table (transactions)
CREATE TABLE Borrowings (
    BorrowID INT PRIMARY KEY IDENTITY(1,1),
    MemberID INT FOREIGN KEY REFERENCES Members(MemberID),
    BookID INT FOREIGN KEY REFERENCES Books(BookID),
    BorrowDate DATE DEFAULT GETDATE(),
    DueDate DATE,
    ReturnDate DATE NULL,  -- NULL means not returned yet
    CONSTRAINT CHK_DueDate CHECK (DueDate > BorrowDate)
);

Step 3: Insert Sample Data

-- Insert Members
INSERT INTO Members (FirstName, LastName, Email)
VALUES 
('Emma', 'Watson', 'emma.w@email.com'),
('Michael', 'Scott', 'michael.s@email.com'),
('Sarah', 'Johnson', 'sarah.j@email.com');

-- Insert Books
INSERT INTO Books (Title, Author, ISBN, PublishedYear, AvailableCopies)
VALUES
('The Great Gatsby', 'F. Scott Fitzgerald', '9780743273565', 1925, 3),
('To Kill a Mockingbird', 'Harper Lee', '9780061120084', 1960, 2),
('1984', 'George Orwell', '9780451524935', 1949, 1),
('The Hobbit', 'J.R.R. Tolkien', '9780547928227', 1937, 4);

-- Insert Borrowings
INSERT INTO Borrowings (MemberID, BookID, DueDate)
VALUES
(1, 1, DATEADD(day, 14, GETDATE())),  -- Due in 14 days
(2, 3, DATEADD(day, 14, GETDATE())),
(1, 2, DATEADD(day, 7, GETDATE()));   -- Due in 7 days

Step 4: Querying
1. View all active members:

SELECT * FROM Members WHERE IsActive = 1;

2. Find available books:

SELECT Title, Author, AvailableCopies 
FROM Books 
WHERE AvailableCopies > 0;

3. Current borrowed books with member info:

SELECT 
    m.FirstName,
    m.LastName,
    b.Title,
    br.BorrowDate,
    br.DueDate
FROM Borrowings br
JOIN Members m ON br.MemberID = m.MemberID
JOIN Books b ON br.BookID = b.BookID
WHERE br.ReturnDate IS NULL;  -- Not returned yet

4. Books due in next 3 days

SELECT 
    b.Title,
    m.FirstName,
    m.LastName,
    m.Email,
    br.DueDate
FROM Borrowings br
JOIN Books b ON br.BookID = b.BookID
JOIN Members m ON br.MemberID = m.MemberID
WHERE br.ReturnDate IS NULL 
AND br.DueDate BETWEEN GETDATE() AND DATEADD(day, 3, GETDATE());

5. Most popular books (borrowing count):

SELECT 
    b.Title,
    b.Author,
    COUNT(br.BorrowID) AS TimesBorrowed
FROM Books b
LEFT JOIN Borrowings br ON b.BookID = br.BookID
GROUP BY b.Title, b.Author
ORDER BY TimesBorrowed DESC;

6. Update when a book is returned:

-- Mark book as returned
UPDATE Borrowings 
SET ReturnDate = GETDATE()
WHERE MemberID = 1 AND BookID = 1 AND ReturnDate IS NULL;

-- Increase available copies
UPDATE Books
SET AvailableCopies = AvailableCopies + 1
WHERE BookID = 1;

-- Add to your LibraryDB
USE LibraryDB;

CREATE TABLE Fines (
    FineID INT PRIMARY KEY IDENTITY(1,1),
    BorrowID INT FOREIGN KEY REFERENCES Borrowings(BorrowID),
    MemberID INT FOREIGN KEY REFERENCES Members(MemberID), -- For quick lookup
    DaysLate INT NOT NULL,
    DailyFineRate DECIMAL(5,2) DEFAULT 1.00, -- $1 per day default
    -- TotalFine DECIMAL(8,2) AS (DaysLate * DailyFineRate), -- CALCULATED COLUMN!
    TotalFine AS (DaysLate * DailyFineRate) PERSISTED,  -- NO data type here!
    FineDate DATE DEFAULT GETDATE(),
    IsPaid BIT DEFAULT 0, -- 0 = unpaid, 1 = paid
    PaymentDate DATE NULL,
    
    CONSTRAINT CHK_DaysLate CHECK (DaysLate >= 0),
    CONSTRAINT CHK_FineRate CHECK (DailyFineRate > 0)
);

Step 2: Sample Data & Explanation
sql
-- Insert some fines (manually for demo)
INSERT INTO Fines (BorrowID, MemberID, DaysLate, DailyFineRate)
VALUES 
(2, 2, 5, 1.00),   -- 5 days late @ $1/day = $5
(3, 1, 10, 1.50);  -- 10 days late @ $1.50/day = $15
-- Note: TotalFine auto-calculates! (5*1=5, 10*1.5=15)

NEW CONCEPTS INTRODUCED:

1. CALCULATED COLUMN (PERSISTED)
sql
TotalFine DECIMAL(8,2) AS (DaysLate * DailyFineRate) PERSISTED
What: Auto-calculates total fine when you insert data

Why: Ensures accuracy, no manual calculation needed

Example: DaysLate=5 × DailyFineRate=1.00 = TotalFine=5.00

2. DECIMAL Data Type for Money
sql
DECIMAL(8,2)  -- Total up to 999,999.99

Format: DECIMAL(total_digits, decimal_places)

8,2 = 8 total digits, 2 after decimal → 123456.78

Better for money than FLOAT (avoids rounding errors)

3. BIT for Yes/No Fields
sql
IsPaid BIT DEFAULT 0  -- 0 = No, 1 = Yes

Simple toggle: Perfect for status flags

Storage: Uses minimal space (1 bit!)

Step 4: POWERFUL FINE QUERIES
1. Show all unpaid fines with member details:

SELECT 
    m.FirstName,
    m.LastName,
    m.Email,
    b.Title AS BookTitle,
    f.DaysLate,
    f.DailyFineRate,
    f.TotalFine,
    f.FineDate
FROM Fines f
JOIN Members m ON f.MemberID = m.MemberID
JOIN Borrowings br ON f.BorrowID = br.BorrowID
JOIN Books b ON br.BookID = b.BookID
WHERE f.IsPaid = 0;  -- Unpaid only
